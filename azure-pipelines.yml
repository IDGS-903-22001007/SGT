# Pipeline para proyecto Python
# Construye y ejecuta pruebas automáticamente desde GitHub

trigger:
- main  # ejecuta el pipeline cuando haces push a la rama 'main'

pool:
  name: 'AgenteLocal'

steps:
# 1️⃣ Configurar la versión de Python
- task: UsePythonVersion@0
  inputs:
    versionSpec: '3.11'
  displayName: 'Configurar Python 3.11'

# 2️⃣ (Opcional) Verificar archivos en el repo
- script: dir $(Build.SourcesDirectory)
  displayName: 'Ver archivos en el repo'

# 3️⃣ Instalar dependencias
- script: |
    python -m pip install --upgrade pip
    pip install -r $(Build.SourcesDirectory)/requirements.txt
  displayName: 'Instalar dependencias'

# 4️⃣ Ejecutar pruebas
- script: |
    cd $(Build.SourcesDirectory)
    pytest --maxfail=1 --disable-warnings -q
  displayName: 'Ejecutar pruebas con pytest'

# 5️⃣ (Opcional) Generar artefacto si tu proyecto produce algo (ej. build, .zip, etc.)
# - task: PublishBuildArtifacts@1
#   inputs:
#     pathToPublish: 'dist'
#     artifactName: 'build'
#   displayName: 'Publicar artefacto del build'
